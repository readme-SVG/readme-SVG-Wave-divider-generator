<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wave Divider Generator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=Fira+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:       #06090d;
      --s1:       #0c1018;
      --s2:       #131822;
      --s3:       #1a2030;
      --border:   rgba(100,160,255,0.08);
      --accent:   #4f8cff;
      --accent2:  #a78bfa;
      --glow:     rgba(79,140,255,0.15);
      --text:     #dde5f0;
      --muted:    #5a6a80;
      --font:     'Syne', sans-serif;
      --mono:     'Fira Mono', monospace;
    }

    html, body { height: 100%; background: var(--bg); color: var(--text); font-family: var(--font); }

    /* Dot-grid bg */
    body::before {
      content: '';
      position: fixed; inset: 0; z-index: 0;
      background-image: radial-gradient(circle, rgba(79,140,255,0.06) 1px, transparent 1px);
      background-size: 28px 28px;
      pointer-events: none;
    }

    /* Top glow */
    body::after {
      content: '';
      position: fixed; top: -300px; left: 50%; transform: translateX(-50%);
      width: 900px; height: 600px;
      background: radial-gradient(ellipse, rgba(79,140,255,0.07) 0%, transparent 65%);
      pointer-events: none; z-index: 0;
    }

    /* ── BANNER ── */
    .banner {
      position: relative; z-index: 10;
      background: var(--s1);
      border-bottom: 1px solid var(--border);
      padding: 10px 28px;
      display: flex; align-items: center; justify-content: space-between;
    }
    .banner-brand {
      font-family: var(--mono);
      font-size: 11px; letter-spacing: 0.12em; color: var(--muted);
      text-transform: uppercase;
    }
    .banner-brand b { color: var(--accent); font-weight: 500; }
    .gh-link {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 6px 14px;
      background: var(--s2); border: 1px solid var(--border); border-radius: 7px;
      color: var(--text); text-decoration: none;
      font-family: var(--mono); font-size: 11px; font-weight: 500; letter-spacing: 0.05em;
      transition: border-color .2s, box-shadow .2s;
    }
    .gh-link:hover { border-color: rgba(79,140,255,0.3); box-shadow: 0 0 0 3px var(--glow); }
    .gh-link svg { width: 15px; height: 15px; fill: currentColor; }

    /* ── PAGE ── */
    .page {
      position: relative; z-index: 1;
      min-height: calc(100vh - 45px);
      display: flex; flex-direction: column; align-items: center;
      padding: 60px 20px 100px;
    }

    /* ── HEADER ── */
    header { text-align: center; margin-bottom: 64px; }

    .eyebrow {
      display: inline-flex; align-items: center; gap: 8px;
      font-family: var(--mono); font-size: 11px; letter-spacing: 0.14em;
      color: var(--accent); text-transform: uppercase;
      background: rgba(79,140,255,0.07);
      border: 1px solid rgba(79,140,255,0.15);
      border-radius: 100px; padding: 5px 14px;
      margin-bottom: 22px;
    }
    .eyebrow::before { content: '~'; opacity: 0.6; }

    h1 {
      font-size: clamp(38px, 6vw, 72px);
      font-weight: 800;
      letter-spacing: -0.04em;
      line-height: 1.0;
      margin-bottom: 16px;
    }
    h1 em {
      font-style: normal;
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent2) 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      font-size: 16px; color: var(--muted); font-weight: 400;
      max-width: 460px; margin: 0 auto; line-height: 1.6;
    }

    /* ── PREVIEW STRIP ── */
    .preview-strip {
      width: 100%; max-width: 900px;
      background: var(--s1);
      border: 1px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
      margin-bottom: 28px;
      position: relative;
    }

    .preview-label {
      font-family: var(--mono);
      font-size: 10px; letter-spacing: 0.1em; text-transform: uppercase;
      color: var(--muted);
      position: absolute; top: 12px; left: 16px; z-index: 2;
    }

    .preview-wave-wrap {
      line-height: 0;
      position: relative;
      background: var(--bg);
      border-radius: 12px;
      margin: 36px 16px 16px;
      border: 1px solid var(--border);
    }

    .preview-wave-wrap img,
    .preview-wave-wrap svg { width: 100%; display: block; }

    .loading-bar {
      display: none;
      height: 2px;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      animation: loadbar 1s ease-in-out infinite alternate;
    }
    .loading-bar.active { display: block; }
    @keyframes loadbar { from { opacity: 0.3; } to { opacity: 1; } }

    /* ── CONTROLS ── */
    .controls {
      width: 100%; max-width: 900px;
      background: var(--s1);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 28px 32px;
      margin-bottom: 24px;
    }

    .controls-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-bottom: 24px;
    }

    @media (max-width: 700px) {
      .controls-grid { grid-template-columns: 1fr 1fr; }
    }
    @media (max-width: 450px) {
      .controls-grid { grid-template-columns: 1fr; }
    }

    .ctrl {
      display: flex; flex-direction: column; gap: 8px;
    }

    label {
      font-family: var(--mono);
      font-size: 10px; letter-spacing: 0.1em; text-transform: uppercase;
      color: var(--muted);
    }

    select, input[type="number"], input[type="text"] {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 9px;
      padding: 10px 14px;
      color: var(--text);
      font-family: var(--mono);
      font-size: 13px;
      outline: none;
      transition: border-color .2s, box-shadow .2s;
      width: 100%;
      -moz-appearance: textfield; appearance: textfield;
    }

    select {
      cursor: pointer;
      -webkit-appearance: none; appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%235a6a80'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      padding-right: 32px;
    }

    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; }

    select:focus, input:focus {
      border-color: rgba(79,140,255,0.4);
      box-shadow: 0 0 0 3px rgba(79,140,255,0.08);
    }

    .color-pair {
      display: flex; gap: 8px; align-items: center;
    }
    .color-pair input[type="text"] { flex: 1; }
    input[type="color"] {
      width: 40px; height: 40px;
      border: 1px solid var(--border); border-radius: 8px;
      background: var(--bg); padding: 3px;
      cursor: pointer; flex-shrink: 0;
    }

    /* Toggles */
    .toggles-row {
      display: flex; flex-wrap: wrap; gap: 10px;
      margin-bottom: 24px;
    }

    .toggle-btn {
      display: flex; align-items: center; gap: 8px;
      padding: 8px 16px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      font-family: var(--mono); font-size: 11px;
      color: var(--muted); cursor: pointer;
      transition: all .2s;
      user-select: none;
    }
    .toggle-btn:hover { border-color: rgba(79,140,255,0.3); color: var(--text); }
    .toggle-btn.on {
      background: rgba(79,140,255,0.1);
      border-color: rgba(79,140,255,0.35);
      color: var(--accent);
    }
    .toggle-btn .dot {
      width: 8px; height: 8px; border-radius: 50%;
      background: var(--muted); transition: background .2s;
    }
    .toggle-btn.on .dot { background: var(--accent); }

    /* Generate btn */
    .actions { display: flex; gap: 12px; }

    button.gen {
      flex: 1;
      padding: 14px 24px;
      background: var(--accent);
      color: white;
      border: none; border-radius: 10px;
      font-family: var(--font); font-size: 14px; font-weight: 700;
      letter-spacing: 0.04em; cursor: pointer;
      transition: background .2s, box-shadow .2s, transform .1s;
      text-transform: uppercase;
    }
    button.gen:hover {
      background: #6fa3ff;
      box-shadow: 0 4px 24px rgba(79,140,255,0.35);
    }
    button.gen:active { transform: scale(0.98); }

    /* ── OUTPUT ── */
    .output-card {
      width: 100%; max-width: 900px;
      display: none;
      animation: fadeUp .35s ease;
    }
    .output-card.show { display: block; }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(14px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .output-section {
      background: var(--s1);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 16px;
    }

    .section-title {
      font-family: var(--mono);
      font-size: 10px; letter-spacing: 0.12em; text-transform: uppercase;
      color: var(--muted); margin-bottom: 14px;
    }

    .tabs { display: flex; gap: 4px; margin-bottom: 12px; }
    .tab {
      padding: 6px 14px;
      background: transparent;
      border: 1px solid transparent;
      border-radius: 6px;
      font-family: var(--mono); font-size: 11px; color: var(--muted);
      cursor: pointer; transition: all .15s;
    }
    .tab.active {
      background: var(--s2); border-color: var(--border); color: var(--text);
    }

    .code-wrap {
      position: relative;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 10px; overflow: hidden;
    }
    .code-wrap pre {
      padding: 16px;
      font-family: var(--mono); font-size: 12px; color: var(--muted);
      overflow-x: auto; line-height: 1.8;
      white-space: pre-wrap; word-break: break-all;
    }
    .copy-btn {
      position: absolute; top: 10px; right: 10px;
      background: var(--s2); border: 1px solid var(--border); border-radius: 6px;
      padding: 5px 10px; font-family: var(--mono); font-size: 11px; color: var(--muted);
      cursor: pointer; transition: all .15s;
    }
    .copy-btn:hover { color: var(--text); border-color: rgba(79,140,255,0.3); }
    .copy-btn.ok { color: #7ee787; border-color: rgba(126,231,135,0.3); }

    /* ── STYLES ROW ── */
    .presets {
      width: 100%; max-width: 900px;
      margin-bottom: 28px;
    }
    .presets h3 {
      font-family: var(--mono);
      font-size: 10px; letter-spacing: 0.12em; text-transform: uppercase;
      color: var(--muted); margin-bottom: 12px;
    }
    .preset-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }
    @media (max-width: 600px) { .preset-grid { grid-template-columns: 1fr 1fr; } }

    .preset-btn {
      background: var(--s1); border: 1px solid var(--border);
      border-radius: 10px; overflow: hidden; cursor: pointer;
      transition: border-color .2s, transform .15s;
      text-align: left;
    }
    .preset-btn:hover {
      border-color: rgba(79,140,255,0.3);
      transform: translateY(-2px);
    }
    .preset-thumb { height: 40px; }
    .preset-thumb svg { width: 100%; height: 100%; }
    .preset-label {
      padding: 8px 10px;
      font-family: var(--mono); font-size: 10px; color: var(--muted);
      letter-spacing: 0.06em; text-transform: uppercase;
    }
  </style>
</head>
<body>

<!-- BANNER -->
<div class="banner">
  <span class="banner-brand">Built by <b>OstinUA</b></span>
  <a class="gh-link" href="https://github.com/OstinUA" target="_blank" rel="noopener">
    <svg viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61-.546-1.385-1.335-1.755-1.335-1.755-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
    /OstinUA
  </a>
</div>

<div class="page">

  <header>
    <div class="eyebrow">Wave Divider Generator</div>
    <h1>Section <em>separators</em><br/>for your README</h1>
    <p class="subtitle">Generate a clickable, styled SVG wave to drop between sections in any GitHub README or webpage. No API key needed.</p>
  </header>

  <!-- Live preview -->
  <div class="preview-strip">
    <div class="preview-wave-wrap" id="preview-wrap">
      <!-- wave SVG rendered here -->
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 80" width="1200" height="80" preserveAspectRatio="none"><path d="M 0.00 40.00 C 10.00 40.00 20.00 12.33 30.00 12.33 C 40.00 12.33 50.00 40.00 60.00 40.00 C 70.00 40.00 80.00 67.67 90.00 67.67 C 100.00 67.67 110.00 40.00 120.00 40.00 C 130.00 40.00 140.00 12.33 150.00 12.33 C 160.00 12.33 170.00 40.00 180.00 40.00 C 190.00 40.00 200.00 67.67 210.00 67.67 C 220.00 67.67 230.00 40.00 240.00 40.00 C 250.00 40.00 260.00 12.33 270.00 12.33 C 280.00 12.33 290.00 40.00 300.00 40.00 C 310.00 40.00 320.00 67.67 330.00 67.67 C 340.00 67.67 350.00 40.00 360.00 40.00 C 370.00 40.00 380.00 12.33 390.00 12.33 C 400.00 12.33 410.00 40.00 420.00 40.00 C 430.00 40.00 440.00 67.67 450.00 67.67 C 460.00 67.67 470.00 40.00 480.00 40.00 C 490.00 40.00 500.00 12.33 510.00 12.33 C 520.00 12.33 530.00 40.00 540.00 40.00 C 550.00 40.00 560.00 67.67 570.00 67.67 C 580.00 67.67 590.00 40.00 600.00 40.00 C 610.00 40.00 620.00 12.33 630.00 12.33 C 640.00 12.33 650.00 40.00 660.00 40.00 C 670.00 40.00 680.00 67.67 690.00 67.67 C 700.00 67.67 710.00 40.00 720.00 40.00 C 730.00 40.00 740.00 12.33 750.00 12.33 C 760.00 12.33 770.00 40.00 780.00 40.00 C 790.00 40.00 800.00 67.67 810.00 67.67 C 820.00 67.67 830.00 40.00 840.00 40.00 C 850.00 40.00 860.00 12.33 870.00 12.33 C 880.00 12.33 890.00 40.00 900.00 40.00 C 910.00 40.00 920.00 67.67 930.00 67.67 C 940.00 67.67 950.00 40.00 960.00 40.00 C 970.00 40.00 980.00 12.33 990.00 12.33 C 1000.00 12.33 1010.00 40.00 1020.00 40.00 C 1030.00 40.00 1040.00 67.67 1050.00 67.67 C 1060.00 67.67 1070.00 40.00 1080.00 40.00 C 1090.00 40.00 1100.00 12.33 1110.00 12.33 C 1120.00 12.33 1130.00 40.00 1140.00 40.00 C 1150.00 40.00 1160.00 67.67 1170.00 67.67 C 1180.00 67.67 1190.00 40.00 1200.00 40.00 L 1200 80 L 0 80 Z" fill="#161b22" fill-opacity="1.00"/></svg>
    </div>
    <div class="loading-bar" id="loading-bar"></div>
  </div>

  <!-- Presets -->
  <div class="presets">
    <h3>Quick Presets</h3>
    <div class="preset-grid" id="preset-grid">
      <!-- filled by JS -->
    </div>
  </div>

  <!-- Controls -->
  <div class="controls">
    <div class="controls-grid">

      <div class="ctrl">
        <label>Wave Type</label>
        <select id="type">
          <option value="smooth" selected>Smooth Sine</option>
          <option value="sine">Sharp Sine</option>
          <option value="bump">Bumps</option>
          <option value="zigzag">Zigzag</option>
          <option value="triangle">Triangle</option>
        </select>
      </div>

      <div class="ctrl">
        <label>Wave Position</label>
        <select id="position">
          <option value="bottom" selected>Bottom</option>
          <option value="top">Top (Upside Down)</option>
        </select>
      </div>

      <div class="ctrl">
        <label>Width (px)</label>
        <input type="number" id="width" value="1200" min="200" max="2400" step="100"/>
      </div>

      <div class="ctrl">
        <label>Height (px)</label>
        <input type="number" id="height" value="80" min="20" max="200"/>
      </div>

      <div class="ctrl">
        <label>Amplitude</label>
        <input type="number" id="amplitude" value="20" min="1" max="100"/>
      </div>

      <div class="ctrl">
        <label>Frequency</label>
        <input type="number" id="frequency" value="1" min="0.5" max="8" step="0.5"/>
      </div>

      <div class="ctrl">
        <label>Layers (1–3)</label>
        <input type="number" id="layers" value="1" min="1" max="3"/>
      </div>

      <div class="ctrl">
        <label>Top Color</label>
        <div class="color-pair">
          <input type="color" id="color_top_picker" value="#0d1117"/>
          <input type="text" id="color_top" value="#0d1117"/>
        </div>
      </div>

      <div class="ctrl">
        <label>Bottom Color</label>
        <div class="color-pair">
          <input type="color" id="color_bottom_picker" value="#161b22"/>
          <input type="text" id="color_bottom" value="#161b22"/>
        </div>
      </div>

      <div class="ctrl">
        <label>Opacity (0–1)</label>
        <input type="number" id="opacity" value="1" min="0.1" max="1" step="0.05"/>
      </div>

      <div class="ctrl">
        <label>Animation Speed (s)</label>
        <input type="number" id="speed" value="6" min="1" max="20" step="0.5"/>
      </div>
    </div>

    <div class="toggles-row">
      <div class="toggle-btn" id="toggle-flip" onclick="toggle('flip', this)">
        <span class="dot"></span> Flip
      </div>
      <div class="toggle-btn" id="toggle-gradient" onclick="toggle('gradient', this)">
        <span class="dot"></span> Horizontal Gradient
      </div>
      <div class="toggle-btn" id="toggle-mirror" onclick="toggle('mirror', this)">
        <span class="dot"></span> Mirror Ghost
      </div>
      <div class="toggle-btn" id="toggle-animate" onclick="toggle('animate', this)">
        <span class="dot"></span> Wave Animation
      </div>
    </div>

    <div class="actions">
      <button class="gen" onclick="generate()">⟡ Generate Wave</button>
    </div>
  </div>

  <!-- Output -->
  <div class="output-card" id="output">
    <div class="output-section">
      <div class="section-title">Embed Code</div>
      <div class="tabs">
        <button class="tab active" onclick="setTab('markdown', this)">Markdown</button>
        <button class="tab" onclick="setTab('html', this)">HTML</button>
        <button class="tab" onclick="setTab('url', this)">Direct URL</button>
      </div>
      <div class="code-wrap">
        <pre id="code-out"></pre>
        <button class="copy-btn" id="copy-btn" onclick="copyCode()">Copy</button>
      </div>
    </div>
  </div>

</div>

<script>
  // ─── State ───────────────────────────────────────────
  const flags = { flip: false, gradient: false, mirror: false, animate: true };
  let currentTab = 'markdown';
  let lastUrl = '';

  document.getElementById('toggle-animate').classList.add('on');

  // ─── Color sync ──────────────────────────────────────
  function syncColor(pickerId, textId) {
    const p = document.getElementById(pickerId);
    const t = document.getElementById(textId);
    p.addEventListener('input', () => { t.value = p.value; debounce(); });
    t.addEventListener('input', () => {
      if (/^#[0-9a-fA-F]{6}$/.test(t.value)) { p.value = t.value; debounce(); }
    });
  }
  syncColor('color_top_picker', 'color_top');
  syncColor('color_bottom_picker', 'color_bottom');

  // ─── Toggles ─────────────────────────────────────────
  function toggle(key, el) {
    flags[key] = !flags[key];
    el.classList.toggle('on', flags[key]);
    debounce();
  }

  // ─── Debounce live updates ────────────────────────────
  let debTimer = null;
  function debounce() {
    clearTimeout(debTimer);
    debTimer = setTimeout(generate, 300);
  }

  ['type','position','width','height','amplitude','frequency','layers','opacity','speed'].forEach(id => {
    document.getElementById(id).addEventListener('change', debounce);
    document.getElementById(id).addEventListener('input', debounce);
  });

  // ─── Generate ────────────────────────────────────────
  async function generate() {
    const isTopPosition = document.getElementById('position').value === 'top';
    flags.flip = isTopPosition;
    document.getElementById('toggle-flip').classList.toggle('on', flags.flip);

    const params = new URLSearchParams({
      type:         document.getElementById('type').value,
      width:        document.getElementById('width').value,
      height:       document.getElementById('height').value,
      amplitude:    document.getElementById('amplitude').value,
      frequency:    document.getElementById('frequency').value,
      layers:       document.getElementById('layers').value,
      color_top:    document.getElementById('color_top').value.replace('#',''),
      color_bottom: document.getElementById('color_bottom').value.replace('#',''),
      opacity:      document.getElementById('opacity').value,
      flip:         flags.flip,
      gradient:     flags.gradient,
      mirror:       flags.mirror,
      animate:      flags.animate,
      speed:        document.getElementById('speed').value,
    });

    const url = `/wave?${params}`;
    lastUrl = url;

    document.getElementById('loading-bar').classList.add('active');

    // Inline fetch for preview — avoids img src flicker
    try {
      const resp = await fetch(url);
      const svg = await resp.text();
      document.getElementById('preview-wrap').innerHTML = svg;
    } catch(e) {}

    document.getElementById('loading-bar').classList.remove('active');
    document.getElementById('output').classList.add('show');
    updateCode();
  }

  // ─── Code output ─────────────────────────────────────
  function updateCode() {
    const abs = window.location.origin + lastUrl;
    let code = '';
    if (currentTab === 'markdown') {
      code = `![Wave divider](${abs})`;
    } else if (currentTab === 'html') {
      code = `<img src="${abs}" alt="Wave divider" style="width:100%;display:block;" />`;
    } else {
      code = abs;
    }
    document.getElementById('code-out').textContent = code;
  }

  function setTab(tab, btn) {
    currentTab = tab;
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    btn.classList.add('active');
    updateCode();
  }

  function copyCode() {
    navigator.clipboard.writeText(document.getElementById('code-out').textContent).then(() => {
      const b = document.getElementById('copy-btn');
      b.textContent = '✓ Copied'; b.classList.add('ok');
      setTimeout(() => { b.textContent = 'Copy'; b.classList.remove('ok'); }, 2000);
    });
  }

  // ─── Presets ─────────────────────────────────────────
  const PRESET_PALETTES = [
    ['#0d1117', '#161b22'], ['#0a1628', '#0f3460'], ['#1a0a2e', '#f72585'],
    ['#0a1a0d', '#1a4a22'], ['#0f0f0f', '#222222'], ['#f0f0f0', '#ffffff'],
    ['#020010', '#0d0030'], ['#111827', '#1f2937'], ['#001219', '#005f73'],
    ['#3c096c', '#ff6d00'], ['#14213d', '#fca311'], ['#10002b', '#240046'],
  ];

  function randomBetween(min, max, step = 1) {
    const count = Math.round((max - min) / step);
    return min + Math.floor(Math.random() * (count + 1)) * step;
  }

  function buildRandomPresets(count = 4) {
    const types = ['smooth', 'sine', 'bump', 'zigzag'];
    const palettes = [...PRESET_PALETTES].sort(() => Math.random() - 0.5);
    const presets = [];

    for (let i = 0; i < count; i++) {
      const [ct, cb] = palettes[i % palettes.length];
      presets.push({
        label: `Random ${i + 1}`,
        type: types[randomBetween(0, types.length - 1)],
        ct,
        cb,
        amp: randomBetween(10, 35),
        freq: randomBetween(0.5, 3, 0.5),
        layers: randomBetween(1, 3),
        flip: Math.random() > 0.5,
      });
    }

    return presets;
  }

  function buildPreviewSVG(p) {
    const w = 300, h = 40;
    const amp = p.amp * (h / 80);
    const freq = p.freq;
    const mid = h / 2;
    let path = `M 0 ${mid} `;
    const pts = 60;
    for (let i = 1; i <= pts; i++) {
      const x = (i / pts) * w;
      const prevX = ((i-1) / pts) * w;
      const y = mid + amp * Math.sin(2 * Math.PI * freq * (i / pts));
      const py = mid + amp * Math.sin(2 * Math.PI * freq * ((i-1) / pts));
      const cx = (prevX + x) / 2;
      path += `C ${cx} ${py} ${cx} ${y} ${x} ${y} `;
    }
    path += `L ${w} ${h} L 0 ${h} Z`;
    const transform = p.flip ? `transform="scale(1,-1) translate(0,-${h})"` : '';
    return `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${w} ${h}" preserveAspectRatio="none" style="width:100%;height:40px">
      <rect width="${w}" height="${h}" fill="${p.ct}"/>
      <path d="${path}" fill="${p.cb}" ${transform}/>
    </svg>`;
  }

  function applyPreset(p) {
    document.getElementById('type').value = p.type;
    document.getElementById('position').value = p.flip ? 'top' : 'bottom';
    document.getElementById('amplitude').value = p.amp;
    document.getElementById('frequency').value = p.freq;
    document.getElementById('layers').value = p.layers;
    document.getElementById('color_top').value = p.ct;
    document.getElementById('color_top_picker').value = p.ct;
    document.getElementById('color_bottom').value = p.cb;
    document.getElementById('color_bottom_picker').value = p.cb;

    // reset flags
    ['flip','gradient','mirror','animate'].forEach(f => {
      flags[f] = false;
      document.getElementById(`toggle-${f}`).classList.remove('on');
      document.querySelector(`#toggle-${f} .dot`).style.background = '';
    });
    flags.animate = true;
    document.getElementById('toggle-animate').classList.add('on');

    if (p.flip) {
      flags.flip = true;
      document.getElementById('toggle-flip').classList.add('on');
    }

    generate();
  }

  const grid = document.getElementById('preset-grid');
  const randomPresets = buildRandomPresets(4);
  randomPresets.forEach(p => {
    const btn = document.createElement('button');
    btn.className = 'preset-btn';
    btn.innerHTML = `<div class="preset-thumb">${buildPreviewSVG(p)}</div><div class="preset-label">${p.label}</div>`;
    btn.onclick = () => applyPreset(p);
    grid.appendChild(btn);
  });

  // Initial generate on load
  generate();
</script>
</body>
</html>
